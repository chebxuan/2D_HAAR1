# 论文标题：基于整数域的二维量子形态学 Haar 小波变换：电路架构与多方向特征提取
**Title:** Integer-Domain Quantum Morphological Haar Wavelet Transform: Circuit Architecture and Multi-Directional Feature Extraction

---

## 1. Introduction (引言)

### 1.1 研究背景 (Context)
* **量子图像处理 (QIMP) 的演进**：从单纯的图像存储（NEQR, FRQI）向复杂处理算子过渡的需求。
* **经典问题的症结**：经典线性小波在处理高对比度几何边缘时存在 Gibbs 现象（振荡/伪影），无法满足高精度特征提取需求。
* **形态学方法的优势**：数学形态学（Mathematical Morphology）基于非线性算子（Min/Max），具有卓越的边缘保留能力和抗噪性，但缺乏高效的量子电路实现。

### 1.2 现有挑战 (Challenges)
* **非线性算子的缺失**：现有量子小波多为线性变换，难以直接实现形态学核心的 `min/max` 操作。
* **运算域限制**：浮点运算在 NISQ 设备上昂贵且易错。为避免精度截断误差，必须采用 **整数域 (Integer-Domain)** 设计。
* **系统集成难度**：尽管部分基础算术模块已存在，但缺乏将这些模块整合成完整二维形态学小波变换（2D-MHWT）的系统级架构设计。

### 1.3 本文工作与贡献 (Contributions)
1.  **架构设计创新**：设计了首个全整数域的二维量子形态学 Haar 小波变换 (QM-HWT) 电路架构，精确实现了形态学分解的非线性数学公式。
2.  **模块化集成**：创造性地集成了 **Sahin** 的带符号整数算术模块与 **Firmansyah** 的显式 Min/Max 比较器思想，通过优化的互联结构解决了复杂形态学运算的量子化难题。
3.  **边缘检测与特征提取的实验优势**：通过对标准测试图像的实验验证，证明了该方法在边缘检测任务中能够显著抑制线性小波产生的 Gibbs 伪影（灰度光晕），在保留图像几何结构方面具有明显的视觉和数据优势。
4.  **完整验证**：对 4-bit 图像进行了全空间穷举验证（65,536 组输入），确立了电路的 100% 正确性。

---

## 2. Preliminaries (预备知识)

### 2.1 目标模型：二维整数形态学 Haar 小波
本文电路旨在实现以下四个核心分解公式（输入为 $2 \times 2$ 像素块 $\begin{bmatrix} a & b \\ c & d \end{bmatrix}$）：

1.  **低频/近似 (LL)**：$L = \min(a, b, c, d)$
2.  **水平细节 (LH / $H_1$)**：$H_1 = \lfloor ((a-b) + (c-d))/2 \rfloor$
3.  **垂直细节 (HL / $H_2$)**：$H_2 = \lfloor ((a+b) - (c+d))/2 \rfloor$
4.  **对角细节 (HH / $H_3$)**：$H_3 = \lfloor ((a-b) - (c-d))/2 \rfloor$

### 2.2 基础工具 (Foundational Tools)
* **量子图像表示 (NEQR)**：使用 NEQR 模型存储像素，支持整数算术。
* **基于 QFT 的算术模块 (引用 Sahin)**：
    * 采用 **Sahin** 的 `NMAdd` (非模加) 和 `NMSub` (非模减) 算子。
    * **改进点**：引入 Guard Bit (保护位) 机制，防止形态学运算中的中间值溢出。
    * **[Figure 1: Sahin 的加法器/减法器电路结构图]** *(在此处引用 Sahin 的电路图，展示基础算子结构)*
* **比较器设计思想 (引用 Firmansyah)**：
    * 借鉴 **Firmansyah** 的显式输出设计，构建能够同时输出 $|min\rangle$ 和 $|max\rangle$ 的比较器模块。

---

## 3. Methodology & Circuit Design (核心章节：电路设计)

### 3.1 总体架构 (Overall Architecture)
* **输入**：4 个 $n$ 位量子寄存器 $|a\rangle, |b\rangle, |c\rangle, |d\rangle$。
* **输出**：4 个结果寄存器 $L, H_1, H_2, H_3$。
* **[Figure 2: QM-HWT 总体电路架构图]** *(在此处画出 4 个输入如何经过各个模块最终变成 4 个输出的完整流程图)*

### 3.2 基础模块实现 (Basic Modules)
* **算术单元**：集成 Sahin 的加减法器，构建带符号整数运算通路。
* **比较-交换单元 (C_QMSUB + CSWAP)**：利用减法器提取符号位，通过受控交换门 (CSWAP) 实现物理排序。
* **舍入单元 (Rounding Operation)**：
    * 采用 **Chaurra-Gutierrez 等人 (QIST)** 提出的舍入方法。
    * 利用完美洗牌置换 (Perfect Shuffle Permutation, PSP) 矩阵或等效的算术右移操作来实现 $\lfloor x/2 \rfloor$。
    * **[Figure 3: 舍入单元 (Rounding Unit) 示意图]** *(在此处引用或重画 QIST 文献中的舍入操作示意图，说明如何实现除以2)*

### 3.3 主电路流水线 (The 7-Stage Pipeline)
电路通过 7 个流水线阶段完成计算：
1.  **Stage 1 (预处理)**：并行计算差值 $(a-b)$ 和 $(c-d)$。
2.  **Stage 2 (水平细节)**：计算 $H_1 = \text{Round}((a-b) + (c-d))$。
3.  **Stage 3 (对角细节)**：计算 $H_3 = \text{Round}((a-b) - (c-d))$。
4.  **Stage 4 (恢复)**：恢复原始像素值以备排序。
5.  **Stage 5 (局部排序)**：生成两组 $(min, max)$ 对。
6.  **Stage 6 (全局最小)**：提取全局最小值 $L = \min(a,b,c,d)$。
7.  **Stage 7 (垂直细节优化)**：利用数学恒等式 $(a+b)-(c+d) = (\max-\max) + (\min-\min)$，直接复用前序中间结果计算 $H_2$。
* **[Figure 4: 7阶段流水线详细电路时序/逻辑图]** *(核心大图，展示每个阶段的寄存器变化)*

---

## 4. Experimental Validation (实验验证)

### 4.1 正确性验证
* **单元测试**：针对特定输入向量（如 $a=7, b=2...$）进行测试。
* **[Table 1: 单元测试输入输出对照表]** *(展示理论值与量子电路模拟值的对比，证明完全一致)*
* **穷举验证**：对 4-bit 全空间 ($2^{16} = 65,536$ 组) 输入进行自动化验证，错误率为 0%。

### 4.2 图像边缘检测效果 (Edge Detection Performance)
* **实验对象**：House 图像（几何结构明显）、Cameraman 图像。
* **视觉对比分析**：
    * **House 图像二值化**：对比 QM-HWT 与经典线性 Haar 小波在二值化处理后的边缘。
    * **优势展示**：QM-HWT 提取的屋顶和墙角边缘清晰锐利，单像素边缘保持完好；而线性小波在边缘处存在明显的“灰度光晕” (Artifacts) 和模糊。
    * **[Figure 5: House 图像边缘检测对比图]** *(左：原图；中：线性 Haar 边缘；右：QM-HWT 边缘。重点圈出屋顶边缘的区别)*
* **系数稀疏性分析**：
    * 分析高频系数 ($H_1, H_2, H_3$) 的分布情况。
    * **[Figure 6: 高频系数分布直方图]** *(展示 QM-HWT 的系数更集中在 0 附近，证明背景噪声被有效抑制)*
    * **[Table 2: 稀疏性指标统计表]** *(列出零值比例、熵值等具体数据)*

---

## 5. Complexity Analysis (复杂度分析)

### 5.1 空间复杂度
* **量子比特数**：分析电路所需的总量子比特数，随像素位深 $n$ 线性增长。

### 5.2 时间复杂度
* **电路深度**：$O(n)$。主要由 QFT 模块决定，优于经典算法的 $O(N^2)$。
* **并行优势**：在理想量子计算机上，全图 $N^2/4$ 个像素块可并行处理，实现 $O(1)$ 的处理速度（常数级时间）。
* **[Table 3: 复杂度对比表]** *(对比经典算法、线性量子小波与本文方法的空间/时间复杂度)*

---

## 6. Conclusion (结论)

本文提出了一种基于整数域的量子形态学 Haar 小波变换电路架构。通过系统集成 Sahin 的算术模块与 QIST 的舍入算子，成功解决了非线性算子量子化和整数域运算的难题。实验结果证明，该架构在边缘检测任务中，相比经典线性小波能够显著消除 Gibbs 伪影，提供更精准的几何特征提取能力。